---
weight: 30
title: 客服系统
---

### 客服分配算法

业务要求

- 优先机器然后才是人工，可按时段调整
- 上次服务的客服优先分配
- 为该客户服务次数最多的客服优先分配
- 客户有最大接待客户数的上限（假设50）
- 多种分配策略：空闲率分配、轮询分配、权重分配

实现步骤

1. 客户提出问题，AI识别后弹出对应FAQ，如仍无法解决则由用户选择业务模块转入人工流程。
2. 每个客服上线后在Redis中使用Hash存储其动态属性，如当前状态、正在接待人数、最大接待人数等。
3. 将客服按业务分组，同一分组的在线客服存储在Redis的SortedSet中，以接待时间作为score。
4. 用户接入时，首先查找是否存在上次接待过的客服，存在则直接从Hash中取出客服信息，将当前接待人数+1，并更新SortedSet中的score。
5. 如果是首次登入则从SortedSet中取第一个客服进行接待，通过CAS来防止并发竞争。如果失败则通过Shuffle从SortedSet中随机取一个客服进行接待。
6. 当没有客服可分配时，客户进入等待池排队。
7. 当有客服可分配时，按业务组从等待池中按分配策略进行分配；客服也可以手动选择客户。