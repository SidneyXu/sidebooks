---
weight: 40
title: 仓储系统
bookCollapseSection: false
---

# 仓储系统

## 系统划分

- 库存系统：管理商品的可销售数量。商品的库存数量可能是多个仓库的商品数量之和。
- 仓库系统：管理仓库里商品的实际存储数量，商品购买后只要没有出库仓库数据就不会变更。

## 库存系统

### 业务流程

- 商品入库/出库：通过仓库系统的消息调整库存数量。
- 用户下单：锁库存。
- 库存系统和仓库系统按日对账。

### 下单锁库存

为什么选择下单锁库存？

- 如果加入购物车时锁库存，可能会出现单个用户将所有商品都加入购物车导致其他人都无法购买。
- 如果支付成功才锁库存，可能会出现大量用户下单成功却无法支付的情况。
- 如果下单时锁库存，可以选择一定时间未支付后自动释放库存。

回滚库存时机

- 用户下单后超时未支付。
- 用户支付后退款。
- 风控识别到异常行为，强制取消订单。
- 系统异常。

## 仓库系统

业务流程

- 商品入库：完成采购单后，仓库系统调整商品数量，需通知库存系统。
- 商品出库：商品发货后调整商品数量，需通知库存系统。
- 仓库调拨：发起调拨申请时锁库存，调拨出库或调拨入库后释放库存。
- 库存系统和仓库系统按日对账。


