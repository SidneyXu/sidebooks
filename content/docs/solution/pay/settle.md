---
weight: 2
title: 清结算系统
---

# 清结算系统

## 关联系统

- 业务系统：创建交易单，调用支付系统发起支付。
- 支付系统：根据交易单信息，生成支付指令。
- 清算系统：根据支付指令生成支付指令。
- 账务系统：支付完成后流水入账。

实际业务路径根据业务不同公司架构不同，可能有多种路径：
- 由清算系统发起支付：业务系统->支付系统->清算系统->账务系统。所有支付指令经由清算系统生成清算指令，然后由清算指令发起实际转账。
- 由支付系统发起支付：业务系统->（清算系统）->支付系统->账务系统。用户账户到平台账户交易由支付系统完成；清算系统生成平台账户和商户账户间的清算指令，然后由支付系统完成转账。

## 清分流程

支持多渠道支付时，如果在同一时刻进行清分，对系统会造成巨大压力。

1. 清算系统将资金数据以待清算渠道为维度保存到单独的表中（如工商银行资金明细表、招商银行资金明细表）。
2. 清算系统隔一段时间按批次从表中捞取渠道方的明细数据，此间隔时间应小于与渠道方约定的清分时间。为了避免同时清分，不同渠道采用不同间隔时间。
3. 清算系统统计并保存批次内交易数据量和交易金额。
4. 到达清分时间点前，清算系统汇总各批次数据，生成清算指令。

## 商家自定义清算时机

清算时机一般都是平台方和渠道方约定的，和商家无关。如果可以由商家自定义清算时间，就可以吸引更多商家入驻平台。

1. 商家配置自定义清算时间。
2. 交易系统向清算系统发出通知，将指定商家不加入结算流程。
2. 交易系统向渠道方发起交易。
3. 交易系统将成功交易同步到账务系统，账务系统进行入账操作。
4. 到了商家自定义清算时间，交易系统调用账务系统查询商家待清算金额。
5. 清算系统在正常清结算时间，调用渠道方获得对账文件。
6. 清算系统去除自定义清算时间的商家后进行资金结算，并调用账务系统进行入账。
7. 由交易系统和账务系统配合进行自定义清算时间的资金结算。




